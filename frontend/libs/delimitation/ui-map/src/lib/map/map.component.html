<ng-container *ngIf="noKey$ | async; else keyExists">
  <p>Задайте API ключ для библиотеки работы с Google Maps</p>

  <mat-form-field>
    <mat-label>API ключ</mat-label>
    <input matInput type="password" [formControl]="apiKeyControl" />
  </mat-form-field>

  <button mat-button (click)="saveApiKey()">Сохранить</button>
</ng-container>

<ng-template #keyExists>
  <div *ngIf="apiLoaded$ | async; else apiFailedToLoad">
    <google-map 
      [width]="null" 
      [options]="options"
      (mapClick)="onMapClick($event)"
    >
      <map-marker
        *ngFor="let point of areaMarkerPoints; index as i"
        #marker="mapMarker"
        [position]="point"
        [options]="areaBoundaryMarkerOptions[i]"
        (positionChanged)="onAreaBoundaryMarkerPositionChanged(marker.getPosition().toJSON(), i)"
        (mapDragend)="onAreaBoundaryMarkerDragEnd()"
        (mapClick)="onAreaBoundaryMarkerClick(i)"
      ></map-marker>
      <map-polygon 
        [options]="areaPolygonOptions"
        [paths]="areaPolygonPoints"
      ></map-polygon>

      <ng-container *ngFor="let track of (tracks || [])">
        <map-polyline 
          [options]="tracksOptions"
          [path]="track || []"
        ></map-polyline>
      </ng-container>
    </google-map>
  </div>

  <ng-template #apiFailedToLoad>
    <p>Не удалось загрузить библиотеку для работы с Google Maps</p>
  </ng-template>
</ng-template>
